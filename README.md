# DOCX模板生成器 - 使用文档

## 概述

这是一个基于Web的DOCX文档批量生成工具，可以通过上传DOCX模板文件和JSON数据，自动生成个性化的Word文档。支持单个合并文档和多个独立文档两种生成模式。

## 核心功能

### 1. 模板上传
- **支持格式**：.docx文件
- **文件大小限制**：最大10MB
- **上传方式**：
  - 点击上传区域选择文件
  - 拖拽文件到上传区域
- **模板要求**：使用 `{}` 包裹变量名作为占位符，如 `{child.name}`

### 2. 数据输入
- **支持格式**：JSON数组
- **输入方式**：
  - 手动输入JSON数据
  - 上传.json文件
- **数据结构**：必须是数组格式，每个对象对应一条记录

### 3. 生成模式
- **单个文档**：所有数据合并到一个文档，每条数据生成一页
- **多个文档**：为每条数据生成独立的文档，打包成ZIP下载

## 使用流程

### 步骤1：准备模板文件
创建包含占位符的DOCX模板，占位符语法：
```
{对象.属性}     // 例如：{child.name}
{对象.属性}     // 例如：{interview.time}
```

### 步骤2：准备JSON数据
数据必须是数组格式，例如：
```json
[
  {
    "child": {
      "name": "小明",
      "class": "大班（2）班"
    },
    "interview": {
      "time": "2025-10-21",
      "teacher": "李老师"
    }
  },
  {
    "child": {
      "name": "小红",
      "class": "中班（1）班"
    },
    "interview": {
      "time": "2025-10-22",
      "teacher": "张老师"
    }
  }
]
```

### 步骤3：上传模板和数据
1. 点击或拖拽上传DOCX模板文件
2. 输入或上传JSON数据
3. 系统会自动验证JSON格式和数据数量

### 步骤4：选择生成模式
- **生成单个文档**：将所有数据合并到一个Word文档中，每条数据占一页
- **生成多个文档**：为每条数据生成单独的Word文档，打包成ZIP文件

### 步骤5：下载生成结果
- 单个文档：直接下载.docx文件
- 多个文档：下载.zip压缩包，包含所有生成的文档

## 技术实现

### 核心技术栈
- **前端框架**：原生HTML + JavaScript
- **UI样式**：Tailwind CSS
- **图标库**：Font Awesome
- **文档生成**：docx-templates库
- **文件处理**：JSZip、FileSaver.js

### 关键功能模块

#### 1. 文件上传模块
- 支持拖拽和点击上传
- 文件格式验证
- 文件大小限制检查
- 实时文件信息显示

#### 2. JSON验证模块
- 实时JSON格式验证
- 数组格式检查
- 数据统计显示
- 错误提示

#### 3. 文档生成模块
```javascript
// 核心生成函数
const report = await createReport({
  template: templateContent,
  data: data,
  cmdDelimiter: ["{", "}"]
});
```

#### 4. 文档合并模块
- XML级别的文档内容提取
- 分页符自动处理
- 资源文件（图片、样式）合并
- 合并后的文档结构优化

#### 5. ZIP打包模块
- 批量文档生成
- 动态文件命名
- 进度显示
- 压缩打包下载

## 数据结构示例

### 完整数据结构（当前示例）
```json
{
  "child": {
    "name": "姓名",
    "class": "班级",
    "gender": "性别"
  },
  "interview": {
    "time": "时间",
    "object": "访谈对象",
    "teacher": "教师"
  },
  "details": {
    "school_situation": "在园表现",
    "cause_analysis": "原因分析",
    "teacher_measures": "教师措施",
    "parent_suggestions": "家长建议",
    "parent_expectations": "家长期望"
  },
  "signatures": {
    "parent": "家长签名",
    "principal": "园长签名"
  }
}
```

### 模板中的占位符对应
- `{child.name}` → 学生姓名
- `{child.class}` → 班级
- `{interview.time}` → 访谈时间
- `{details.school_situation}` → 在园表现
- 其他字段以此类推

## 界面布局

### 顶部导航
- 应用标题和图标
- 简短的功能描述

### 主内容区
1. **使用说明卡片**：基本功能介绍
2. **上传区域**（并排布局）：
   - 左侧：模板文件上传
   - 右侧：JSON数据输入
3. **操作按钮**：两个生成模式按钮
4. **状态区域**：加载、成功、错误状态显示

### 页脚
- 版权信息
- 技术栈标识

## 错误处理

### 常见错误类型
1. **文件格式错误**：非DOCX文件
2. **JSON格式错误**：语法错误或非数组格式
3. **数据为空**：没有有效数据
4. **生成失败**：模板或数据问题
5. **合并失败**：文档结构问题

### 错误提示方式
- 实时验证提示
- 弹窗错误消息
- 状态区域错误显示
- 控制台详细日志

## 性能优化

### 前端优化
- 异步处理避免界面卡顿
- 进度显示提升用户体验
- 内存管理优化
- 大文件处理优化

### 生成优化
- 单文档生成速度优化
- 批量文档生成队列
- 文档合并算法优化
- 压缩打包效率提升

## 扩展建议

### 功能扩展
1. **模板预览**：上传后预览模板内容
2. **数据编辑器**：可视化JSON数据编辑
3. **模板库**：预设常用模板
4. **历史记录**：保存生成历史
5. **批量导出**：支持更多格式

### 技术改进
1. **后端API**：处理大文件和复杂模板
2. **数据库存储**：保存模板和数据
3. **用户系统**：多用户支持
4. **云存储**：文件云端管理

## 注意事项

### 安全性
- 仅支持客户端处理
- 文件不会上传到服务器
- 数据处理完全本地化

### 兼容性
- 支持现代浏览器
- 需要JavaScript支持
- 推荐使用Chrome/Firefox

### 最佳实践
- 模板文件尽量简洁
- JSON数据结构统一
- 大批量数据建议分批处理
- 定期清理生成文件

## 技术支持

如遇到问题，请检查：
1. 浏览器控制台错误信息
2. 模板文件格式是否正确
3. JSON数据格式是否有效
4. 网络连接是否正常

---

**版本**: 1.0
**更新日期**: 2025年10月22日